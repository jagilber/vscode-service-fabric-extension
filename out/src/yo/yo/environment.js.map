{"version":3,"file":"environment.js","sourceRoot":"","sources":["../../../yo/yo/environment.ts"],"names":[],"mappings":";;AAAA,6BAA6B;AAC7B,yBAAyB;AACzB,8CAA8C;AAC9C,2BAAuB;AACvB,uCAAoC;AACpC,MAAM,MAAM,GAAG,OAAO,CAAC,oBAAoB,CAAC,CAAC;AAC7C,MAAM,IAAI,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAEnC,MAAM,KAAK,GAAG,OAAO,CAAC,QAAQ,KAAK,OAAO,CAAC;AAE3C,MAAM,WAAW,GAAG;IACnB,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE;QAC1B,OAAO,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;KACnD;IAED,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC;IAEtB,gDAAgD;IAChD,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,cAAc,CAAC,CAAC,CAAC;IAE/G,2CAA2C;IAC3C,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,aAAa,EAAE,EAAC,QAAQ,EAAE,MAAM,EAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC;IAEvF,gCAAgC;IAChC,IAAI,KAAK,EAAE;QACV,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,EAAE,cAAc,CAAC,CAAC,CAAC;KAClE;SAAM;QACN,KAAK,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;KACpC;IAED,IAAI;QACH,6DAA6D;QAC7D,MAAM,UAAU,GAAG,YAAY,CAAC,QAAQ,CAAC,oBAAoB,EAAE,EAAC,QAAQ,EAAE,MAAM,EAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAE,CAAC;QACrG,MAAM,OAAO,GAAG,EAAE,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAC7D,MAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,eAAe,QAAG,EAAE,CAAC,CAAC,CAAC;QAE9D,IAAI,KAAK,EAAE;YACV,IAAI,KAAK,EAAE;gBACV,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC,CAAC;aAChD;iBAAM;gBACN,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,cAAc,CAAC,CAAC,CAAC;aACvD;SACD;KACD;IAAC,OAAO,GAAG,EAAE;KAEb;IAED,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;AAC9B,CAAC,CAAC;AAEF,mBAAyB,IAAY,EAAE,IAAU;IAChD,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;IAClB,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;IAElB,IAAI,GAAG,GAAG,MAAM,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,iBAAW,EAAE,CAAC,CAAC;IAC1D,GAAG,CAAC,WAAW,GAAG,WAAW,CAAC;IAE9B,OAAO,GAAG,CAAC;AACZ,CAAC;AARD,4BAQC","sourcesContent":["import * as path from 'path';\r\nimport * as fs from 'fs';\r\nimport * as childProcess from 'child_process';\r\nimport {EOL} from 'os';\r\nimport CodeAdapter from './adapter';\r\nconst yeoman = require('yeoman-environment');\r\nconst uniq = require('array-uniq');\r\n\r\nconst win32 = process.platform === 'win32';\r\n\r\nconst getNpmPaths = function () {\r\n\tif (process.env.NODE_PATH) {\r\n\t\treturn process.env.NODE_PATH.split(path.delimiter);\r\n\t}\r\n\r\n\trequire('fix-path')();\r\n\r\n\t// Get the npm path from the user env variables.\r\n\tconst paths = process.env.PATH.split(path.delimiter).map(item => path.join(item, '..', 'lib', 'node_modules'));\r\n\r\n\t// Add npm path by running npm root command\r\n\tpaths.push(childProcess.execSync('npm root -g', {encoding: 'utf8'}).toString().trim());\r\n\r\n\t// Default paths for each system\r\n\tif (win32) {\r\n\t\tpaths.push(path.join(process.env.APPDATA, 'npm', 'node_modules'));\r\n\t} else {\r\n\t\tpaths.push('/usr/lib/node_modules');\r\n\t}\r\n\r\n\ttry {\r\n\t\t// Somehow `npm get prefix` does not return the correct value\r\n\t\tconst userconfig = childProcess.execSync('npm get userconfig', {encoding: 'utf8'}).toString().trim();\r\n\t\tconst content = fs.readFileSync(userconfig).toString('utf8');\r\n\t\tconst match = content.match(new RegExp(`prefix=(.*?)${EOL}`));\r\n\r\n\t\tif (match) {\r\n\t\t\tif (win32) {\r\n\t\t\t\tpaths.push(path.join(match[1], 'node_modules'));\r\n\t\t\t} else {\r\n\t\t\t\tpaths.push(path.join(match[1], 'lib', 'node_modules'));\r\n\t\t\t}\r\n\t\t}\r\n\t} catch (err) {\r\n\r\n\t}\r\n\r\n\treturn uniq(paths.reverse());\r\n};\r\n\r\nexport default function (args?: any[], opts?: any) {\r\n\targs = args || [];\r\n\topts = opts || {};\r\n\r\n\tlet env = yeoman.createEnv(args, opts, new CodeAdapter());\r\n\tenv.getNpmPaths = getNpmPaths;\r\n\r\n\treturn env;\r\n}\r\n"]}